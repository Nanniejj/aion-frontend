<template>
  <span>
    <div>
      <hr>
      <p>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ : ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∏‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Keyword ‡πÉ‡∏´‡πâ enter ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ñ‡∏≥</p>
      <b-container>
        <!-- ‡∏õ‡∏∏‡πà‡∏° Clear & Import CSV -->
        <!-- <div class="d-flex justify-content-end mb-3">
          <b-button variant="outline-secondary" @click="clearForm">
            <i class="bi bi-eraser"></i> clear
          </b-button>
          <b-button variant="outline-secondary" class="ml-2">
            <i class="bi bi-upload"></i> import CSV
          </b-button>
        </div> -->

        <!-- Social Media Inputs -->

        <!-- Object Name -->
        <b-form-group label="Object"
        label-class="font-weight-bold">
          <b-form-input
            v-model="objectName"
            maxlength="50"
            required
          ></b-form-input>
          <small class="text-muted"
            >{{ objectName.length }} / 50 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</small
          >
        </b-form-group>

        <!-- Keywords -->
        <b-form-group label="Keyword"
        label-class="font-weight-bold">
          <b-form-tags
            v-model="keywords"
            placeholder="Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà"
          ></b-form-tags>
        </b-form-group>

        <b-form-group>
          <label
            ><b
              >Include Keyword <span class="badge badge-warning">AND</span></b
            ></label
          >
          <b-alert variant="info" show>
            ‡πÉ‡∏ä‡πâ <b>+</b> ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ AND ‡πÄ‡∏ä‡πà‡∏ô <strong>‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á + ‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</strong>
          </b-alert>
          <b-form-tags
            v-model="andKeywords"
            placeholder="Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà"
            @input="logAndKeywords"
          ></b-form-tags>
        </b-form-group>

        <b-form-group>
          <label
            ><b
              >Exclude Keyword <span class="badge badge-danger">NOT</span></b
            ></label
          >
          <b-form-tags
            v-model="notKeywords"
            placeholder="Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà"
            @input="logNotKeywords"
          ></b-form-tags>
        </b-form-group>

        <!-- Include Keyword AND -->
        <!-- <b-form-group>
          <label
            ><b
              >Include Keyword <span class="badge badge-warning">AND</span></b
            ></label
          >
          <b-alert variant="info" show>
            ‡πÉ‡∏ä‡πâ <b>+</b> ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ AND ‡πÄ‡∏ä‡πà‡∏ô <strong>‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á + ‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</strong>
          </b-alert>
          <b-form-tags
            v-model="includeKeywords"
            placeholder="Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà"
          ></b-form-tags>
        </b-form-group> -->

        <!-- Exclude Keyword NOT -->
        <!-- <b-form-group>
          <label
            ><b
              >Exclude Keyword <span class="badge badge-danger">NOT</span></b
            ></label
          >
          <b-form-tags
            v-model="excludeKeywords"
            placeholder="Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà"
          ></b-form-tags>
        </b-form-group> -->

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
        <!-- <b-row>
          <b-col md="12" class="text-center">
            <b-button
              variant="success"
              class="btn-save"
              :disabled="!selectedObject"
              @click="saveData"
            >
              ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </b-button>
          </b-col>
        </b-row> -->

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏õ‡∏¥‡∏î -->
        <div class="d-flex justify-content-end mt-3">
          <b-button           
          style="background-color: #4b371c; border:  #4b371c; color: white;"           
          @click="closeModal"
            >‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</b-button
          >
          <b-button 
          style="background-color: #50c1d0; color: black; border:#50c1d0;"
          class="ml-2" 
          @click="saveObject"
            >‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</b-button
          >
        </div>

        <!-- Status Message -->
        <!-- <b-row v-if="statusMessage" class="mt-3">
          <b-col md="12" class="text-center">
            <div class="alert" :class="statusClass">{{ statusMessage }}</div>
          </b-col>
        </b-row> -->
      </b-container>
    </div>
  </span>
</template>

<script>
import axios from "axios";
import vSelect from "vue-select";
import "vue-select/dist/vue-select.css";

export default {
  name: "CreateObject",
  components: { vSelect },
  data() {
    return {
      objectName: "",
      keywords: [],
      and_keywords: this.andKeywords || [],
      not_keywords: this.notKeywords || [],
      domainId: 1, // ‡∏Ñ‡πà‡∏≤ domain_id
      subdomainId: 1383, // ‡∏Ñ‡πà‡∏≤ subdomain_id ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î
      statusMessage: "", // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      statusClass: "", // ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    };
  },
  methods: {
    clearForm() {
      this.objectName = "";
      this.keywords = [];
      this.andKeywords = [];
      this.notKeywords = [];
    },
    closeModal() {
      this.$bvModal.hide("add-object-modal");
    },
    async saveObject() {
      if (!this.objectName.trim()) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ Object");
        return;
      }

      if (!this.subdomainId) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö Subdomain ID");
        return;
      }

      //‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ API
      const newObjectData = {
        domain_id: this.domainId,
        subdomain_id: this.subdomainId,
        name: this.objectName.trim(),
        keywords: Array.isArray(this.keywords) ? this.keywords : [],
        and_keywords: Array.isArray(this.andKeywords) ? this.andKeywords : [],
        not_keywords: Array.isArray(this.notKeywords) ? this.notKeywords : [],
      };

      console.log(
        "üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ API:",
        JSON.stringify(newObjectData, null, 2)
      );

      try {
        const response = await axios.post(
          "https://api2.cognizata.com/api/v2/monitor/postObject",
          // "https://api2.cognizata.com/api/v2/monitor/monitorCandidates"
          newObjectData,
          {
            headers: {
              Authorization: "Bearer " + localStorage.getItem("token"),
              "Content-Type": "application/json",
            },
          }
        );

        console.log("Object created successfully:", response.data);

        this.closeModal();

        // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
        setTimeout(() => {
          window.location.reload();
        }, 500);
      } catch (error) {
        console.error("Error creating object:", error.response?.data || error);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Object");
      }
    },
    logAndKeywords() {
      console.log("and_keywords ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:", this.andKeywords);
    },
    logNotKeywords() {
      console.log("not_keywords ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:", this.notKeywords);
    },
  },
};
</script>

<style scoped>
.badge-warning {
  background-color: #ffc107;
  color: black;
}
.badge-danger {
  background-color: #dc3545;
}

.custom-dropdown .v-select {
  width: 100%;
}

.custom-dropdown .vs__dropdown-menu {
  z-index: 1050; /* ‡πÉ‡∏´‡πâ dropdown ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
}

.icon-circle {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 15px;
  margin-top: 25px;
}

::v-deep .b-form-tags .b-form-tag {
  background-color: #fddfa2 !important; /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô */
  color: rgb(48, 47, 47) !important; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
  font-weight: bold;
  border-radius: 15px;
  padding: 5px 10px;
  margin: 3px;
}

.btn-save {
  background-color: #50c1d0;
  /* background-color: #fdd071; */
  color: white; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
  font-size: 16px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
  padding: 10px 20px; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô */
  border: none; /* ‡∏•‡∏ö‡∏Å‡∏£‡∏≠‡∏ö */
  border-radius: 5px; /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô */
  cursor: pointer; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠ hover */
}

.alert {
  font-size: 16px;
  padding: 10px;
}

</style>
